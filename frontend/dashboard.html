<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Crazy Web Bot - Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Montserrat', Arial, sans-serif;
      background: linear-gradient(120deg, #00ff99 0%, #3333ff 60%, #ff00cc 100%);
      background-size: 200% 200%;
      animation: crazybg 10s linear infinite alternate;
    }
    @keyframes crazybg {
      0% {background-position: 0% 70%;}
      100% {background-position: 100% 30%;}
    }
    .dashboard-container {
      max-width: 900px;
      margin: 30px auto;
      background: rgba(0,0,0,0.21);
      border-radius: 16px;
      box-shadow: 0 4px 22px #ff00cc44;
      padding: 1.5em 2em 2em 2em;
      backdrop-filter: blur(7px);
      color: #fff;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1em;
    }
    h1 {
      font-size: 2em;
      font-weight: 800;
      letter-spacing: 2px;
      color: #00ff99;
      text-shadow: 0 4px 14px #ff00cc88;
      animation: crazy 1.3s infinite alternate;
    }
    @keyframes crazy {
      0% {transform: scale(1) rotate(-2deg);}
      100% {transform: scale(1.04) rotate(2deg);}
    }
    #logout-btn {
      padding: 0.7em 1.4em;
      border-radius: 10px;
      border: none;
      background: linear-gradient(90deg, #ff00cc 30%, #3333ff 100%);
      color: #fff;
      font-weight: 700;
      font-size: 1em;
      box-shadow: 0 2px 13px #00ffcc55;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
    }
    #logout-btn:hover {
      background: linear-gradient(90deg, #3333ff 30%, #ff00cc 100%);
      transform: scale(1.09);
    }
    section {
      margin-top: 1.3em;
      padding: 1.2em;
      border-radius: 13px;
      background: rgba(255,255,255,0.09);
      box-shadow: 0 2px 8px #00ff9966;
      margin-bottom: 0.7em;
    }
    h2 {
      font-size: 1.3em;
      color: #ff00cc;
      text-shadow: 0 2px 10px #3333ff33;
      margin-bottom: 0.7em;
    }
    #console {
      min-height: 110px;
      max-height: 250px;
      overflow-y: auto;
      background: #0d0d27;
      color: #00ff99;
      font-family: 'Fira Mono', monospace;
      border-radius: 10px;
      box-shadow: 0 2px 13px #ff00cc44;
      padding: 1em;
      font-size: 1em;
    }
    #logs p {
      margin: 0.3em 0;
      animation: fadeIn 0.9s;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: scale(0.95);}
      to {opacity: 1; transform: scale(1);}
    }
    #commands {
      display: flex;
      align-items: center;
      gap: 1em;
      background: #1a1a3b;
      padding: 1em;
      border-radius: 10px;
      box-shadow: 0 2px 10px #3333ff44;
    }
    #command-input {
      flex: 1;
      padding: 0.9em;
      border-radius: 8px;
      border: none;
      background: #fff8;
      color: #222;
      font-size: 1em;
      font-family: inherit;
      box-shadow: 0 2px 8px #00ff9944;
      outline: none;
    }
    #send-command {
      padding: 0.7em 1.3em;
      border-radius: 10px;
      border: none;
      background: linear-gradient(90deg, #00ff99 30%, #ff00cc 100%);
      color: #fff;
      font-weight: 700;
      font-size: 1em;
      box-shadow: 0 2px 10px #00ff9944;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
    }
    #send-command:hover {
      background: linear-gradient(90deg, #ff00cc 30%, #00ff99 100%);
      transform: scale(1.08);
    }
    #status {
      margin-top: 0.6em;
      background: #17172f;
      color: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 13px #3333ff44;
      padding: 1em;
    }
    @media (max-width: 700px) {
      .dashboard-container {
        max-width: 98vw;
        margin: 1vh;
        padding: 1em 0.3em;
      }
      #commands {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <main class="dashboard-container">
    <header>
      <h1>Crazy Web Bot ðŸ¤–</h1>
      <button id="logout-btn">DÃ©connexion</button>
    </header>
    <section id="console">
      <h2>Console Bot</h2>
      <div id="logs"></div>
    </section>
    <section id="commands">
      <input type="text" id="command-input" placeholder=".menu">
      <button id="send-command">Envoyer</button>
    </section>
    <section id="status">
      <h2>Status Session</h2>
      <div id="session-info"></div>
    </section>
  </main>
  <script type="module">
    const logsDiv = document.getElementById('logs');
    const commandInput = document.getElementById('command-input');
    const sendBtn = document.getElementById('send-command');
    const sessionInfoDiv = document.getElementById('session-info');
    const logoutBtn = document.getElementById('logout-btn');

    // WebSocket for live logs
    const ws = new WebSocket(`ws://${window.location.host}/ws`);
    ws.onmessage = (event) => {
      const log = JSON.parse(event.data);
      const p = document.createElement('p');
      p.textContent = `[${log.time}] ${log.text}`;
      logsDiv.appendChild(p);
      logsDiv.scrollTop = logsDiv.scrollHeight;
    };

    // Send command
    sendBtn.addEventListener('click', async () => {
      const cmd = commandInput.value;
      if(!cmd) return;
      commandInput.disabled = true;
      sendBtn.disabled = true;
      const res = await fetch('/api/command', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({command: cmd})
      });
      const data = await res.json();
      const p = document.createElement('p');
      p.textContent = data.result || data.error;
      logsDiv.appendChild(p);
      logsDiv.scrollTop = logsDiv.scrollHeight;
      commandInput.value = "";
      commandInput.disabled = false;
      sendBtn.disabled = false;
    });

    commandInput.addEventListener('keydown', e => {
      if(e.key === 'Enter') sendBtn.click();
    });

    // Fetch session info
    async function fetchSession() {
      const res = await fetch('/api/session');
      const data = await res.json();
      sessionInfoDiv.textContent = data.status || "Non connectÃ©";
    }
    fetchSession();

    // Logout
    logoutBtn.addEventListener('click', async () => {
      await fetch('/api/logout', {method: 'POST'});
      window.location.href = '/';
    });
  </script>
</body>
</html>
